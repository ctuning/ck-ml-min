
CXX=$(CK_CXX)
AR_RCS=$(CK_LB)

CXXFLAGS=$(CK_COMPILER_FLAGS_OBLIGATORY) $(CK_CXXFLAGS) $(CK_FLAG_PREFIX_INCLUDE).. -MMD -MP
#$(CK_FLAGS_STATIC_LIB) - we should add it only for static but not for dynamic
LDFLAGS=$(CK_LFLAGS)

SRC=$(CK_SRC_FILES)
OBJ=$(SRC:.cpp=.o)
DEP=$(SRC:.cpp=.d)

TARGET_DIR=$(INSTALL_DIR)/install/lib
LIB_STATIC=$(TARGET_DIR)/$(CK_TARGET_LIB)$(CK_LIB_EXT)
LIB_DYNAMIC=$(TARGET_DIR)/$(CK_TARGET_LIB)$(CK_DLL_EXT)

.PHONY: all clean

all: $(LIB_STATIC) $(LIB_DYNAMIC)

-include $(DEP)

$(LIB_STATIC): $(OBJ) | $(TARGET_DIR)
	$(AR_RCS) $@ $(OBJ)

$(LIB_DYNAMIC): $(OBJ) | $(TARGET_DIR)
#	$(CXX) $(CK_FLAGS_DLL) $(CXXFLAGS) $(CK_FLAGS_OUTPUT) $(LIB_DYNAMIC) $(CK_FLAGS_DLL_EXTRA) $(CK_LD_FLAGS_MISC) $(CK_LD_FLAGS_EXTRA) $(OBJ) $(CK_LFLAGS)
	$(CXX) -shared $(CK_CXXFLAGS) $(CK_COMPILER_FLAGS_OBLIGATORY) $(CK_FLAGS_OUTPUT) $(LIB_DYNAMIC) $(CK_FLAGS_DLL_EXTRA) $(CK_LD_FLAGS_MISC) $(CK_LD_FLAGS_EXTRA) $(OBJ) -L$(TARGET_DIR) -L. $(CK_LFLAGS) $(ARMCL_EXTRA_LIB)

clean:
	rm -rf $(OBJ) $(LIB_STATIC) $(LIB_DYNAMIC) $(DEP)

$(TARGET_DIR):
	mkdir -p $@
